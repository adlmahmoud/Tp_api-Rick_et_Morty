package controllers

import (
	"exemple/helpers"
	"exemple/services"
	"exemple/templates"
	"fmt"
	"net/http"
)

// DisplayListCharacters
// ---------------------
// Objectif :
//   - Appeler le service SearchCharactersService avec le prénom "rick".
//   - Vérifier le statut et l'erreur éventuelle.
//   - En cas de succès : rendre le template "list-characters" avec les données. (il faut le completer)
//   - En cas d’erreur : rediriger vers une page d'erreur.
func DisplayListCharacters(w http.ResponseWriter, r *http.Request) {

	// TODO Étape 1 : Appeler services.SearchCharactersService("rick").
	charctere, status, err := services.SearchCharactersService("rick")
	// TODO Étape 2 : Vérifier si status != http.StatusOK ou err != nil.
	if status != http.StatusOK || err != nil {
		fmt.Printf("Erreur de reponse - code %v, err %v\n", status, err)
	}
	// Si erreur → helpers.RedirectToError(...) + fmt.Println(err) + return.
	if err != nil {
		helpers.RedirectToError(w, r, status, "Erreur lors de la récupération des personnages")
		fmt.Println(err)
		return
	}
	// TODO Étape 3 : Si tout est OK, appeler templates.RenderTemplate
	// avec le nom du template "list-characters" et les données.

	// Exemple : templates.RenderTemplate(w, r, "name-template", data)
	templates.RenderTemplate(w, r, "list-characters", charctere)
}

// DisplayDetailsRick
// ------------------
// Objectif :
//   - Appeler le service DetailsCharacterService avec l'id de Rick Sanchez (1).
//   - Vérifier le statut et l'erreur éventuelle.
//   - En cas de succès : rendre le template "details-rick" avec les données. (il faut le completer)
//   - En cas d’erreur : rediriger vers une page d'erreur.
func DisplayDetailsRick(w http.ResponseWriter, r *http.Request) {

	// TODO Étape 1 : Appeler services.DetailsCharacterService(1).
	details, status, err := services.DetailsCharacterService(1)

	// TODO Étape 2 : Vérifier le status et l’erreur.
	if status != http.StatusOK || err != nil {
		fmt.Printf("Erreur de reponse - code %v, err %s\n", status, err.Error())
	}
	// Si erreur → helpers.RedirectToError(...) + fmt.Println(err) + return.
	if err != nil {
		helpers.RedirectToError(w, r, status, "Erreur lors de la récupération des personnages")
		fmt.Println(err)
		return
	}
	// TODO Étape 3 : Si succès, appeler templates.RenderTemplate
	// avec le nom du template "details-rick" et les données.

	templates.RenderTemplate(w, r, "details-rick", details)
}
